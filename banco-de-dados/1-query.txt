    drop table if exists #tmp_pessoa_izpay;
                drop table if exists #tmp_pessoa_comunicacao;
                drop table if exists #pessoaTag;                     SELECT distinct tp.cod_pessoa,
                                CASE when tsms.cod_classif_pessoa in (40000,40001)  THEN 0 ELSE 1 END AS bol_comunicacao_sms, 
                                CASE WHEN temail.cod_classif_pessoa in (40002,40003) THEN 0 ELSE 1 END AS bol_comunicacao_email, 
                                CASE WHEN twhat.cod_classif_pessoa in (11000) THEN 1 ELSE 0 END AS bol_comunicacao_whatsapp
                into #tmp_pessoa_comunicacao
                FROM dbo.tab_pessoa tp WITH(NOLOCK)
                LEFT JOIN dbo.tab_tag_pessoa tsms   with(nolock) ON tp.cod_pessoa = tsms.cod_pessoa AND tsms.cod_classif_pessoa IN(40000, 40001)
                LEFT JOIN dbo.tab_tag_pessoa temail with(nolock) ON tp.cod_pessoa = temail.cod_pessoa AND temail.cod_classif_pessoa IN(40002, 40003)
                LEFT JOIN dbo.tab_tag_pessoa twhat  with(nolock) ON tp.cod_pessoa = twhat.cod_pessoa AND twhat.cod_classif_pessoa IN(11000)
                order by cod_pessoa                 SELECT ttp.cod_pessoa,
                ttp.cod_classif_pessoa,
                        tcp.nom_classif_cliente
                INTO #pessoaTag
                FROM dbo.tab_tag_pessoa AS ttp WITH (NOLOCK)
                INNER JOIN dbo.tab_classif_pessoa AS tcp with(nolock) ON tcp.cod_classif_pessoa = ttp.cod_classif_pessoa
                WHERE ttp.cod_classif_pessoa IN ( 1, 2, 3, 4 );                 SELECT
                    tpd.cod_geral_pessoa,
                    tp.cod_pessoa,
                    year(dat_aniversario) num_ano_nascimento,
                    des_sexo,
                    des_cep,                     CAST(dat_cadastro AS DATE) AS dat_cadastro,
                    coalesce(tpc.bol_comunicacao_sms,0) bol_comunicacao_sms,
                    coalesce(tpc.bol_comunicacao_email,0) bol_comunicacao_email,
                    coalesce(tpc.bol_comunicacao_whatsapp,0) bol_comunicacao_whatsapp,
                    CASE WHEN tp.des_device_id_push IS NOT NULL 
                            THEN 1
                            ELSE 0
                    END AS bol_comunicacao_push,
                    tp.des_cidade,
                    tp.des_estado,
                    CASE WHEN tp.cod_usuario = 1002 THEN 'Aplicativo'
                    WHEN tp.cod_usuario = 100 THEN 'Portal Cliente'
                    WHEN tp.cod_usuario = 400 THEN 'Base Legada'
                    ELSE 'Loyalty'
                    END AS origem_cadastro,                     CASE WHEN tpcart.cod_pessoa IS NULL THEN 0
                    ELSE 1
                    END AS possui_cartao,
                    @id id
                FROM tab_pessoa AS tp WITH(NOLOCK)
                inner join tab_pessoa_datalake tpd on tpd.cod_cpf = tp.cod_cpf and tpd.id = @id
                LEFT JOIN #pessoaTag AS pt ON pt.cod_pessoa = tp.cod_pessoa
                left join #tmp_pessoa_comunicacao tpc on tpc.cod_pessoa = tp.cod_pessoa
                left join tab_pessoa_cartao tpcart on tp.cod_pessoa = tpcart.cod_pessoa